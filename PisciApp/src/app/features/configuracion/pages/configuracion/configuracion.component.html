<app-navbar></app-navbar>
<div class="configuracion">
  <h2>Configuraci√≥n</h2>

  <mat-accordion multi="false">
    <!-- PERFIL -->
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>Perfil</mat-panel-title>
      </mat-expansion-panel-header>

      <form class="perfil-form" #f="ngForm" (ngSubmit)="actualizarPerfil()">
        <div *ngIf="user" class="perfil-grid">
          <mat-form-field appearance="outline">
            <mat-label>Nombre completo</mat-label>
            <input matInput [(ngModel)]="user.nombre" name="nombre" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Correo electr√≥nico</mat-label>
            <input
              matInput
              type="email"
              [(ngModel)]="user.email"
              name="email"
            />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Tel√©fono</mat-label>
            <input
              matInput
              type="tel"
              [(ngModel)]="user.telefono"
              name="telefono"
            />
          </mat-form-field>
        </div>

        <div class="perfil-actions">
          <button mat-raised-button color="primary" type="submit">
            Actualizar perfil
          </button>
        </div>
      </form>
    </mat-expansion-panel>

    <!-- SEGURIDAD -->
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>Seguridad</mat-panel-title>
      </mat-expansion-panel-header>

      <!-- CARD DE ESTADO -->
      <div
        class="status-card"
        [ngClass]="{
          enabled: user?.twofa_enabled,
          disabled: !user?.twofa_enabled
        }"
      >
        <div class="status-icon">
          {{ user?.twofa_enabled ? "üõ°Ô∏è" : "‚ö†Ô∏è" }}
        </div>
        <div class="status-text">
          <h4>Autenticaci√≥n de dos factores (2FA)</h4>
          <p>
            {{
              user?.twofa_enabled
                ? "Tu cuenta est√° protegida con 2FA"
                : "Activa 2FA para mayor seguridad"
            }}
          </p>
        </div>
      </div>

      <!-- SI NO EST√Å ACTIVADO -->
      <div *ngIf="!user?.twofa_enabled">
        <button mat-raised-button color="primary" (click)="activar2FA()">
          Activar 2FA
        </button>

        <div *ngIf="qrCodeUrl">
          <p>Escanea este QR en Google Authenticator y valida tu c√≥digo:</p>
          <img [src]="qrCodeUrl" alt="QR Code 2FA" />

          <mat-form-field appearance="outline">
            <mat-label>Introduce el c√≥digo</mat-label>
            <input matInput [(ngModel)]="tokenInput" />
          </mat-form-field>

          <button mat-raised-button color="accent" (click)="confirmar2FA()">
            Confirmar
          </button>
        </div>
      </div>

      <!-- SI YA EST√Å ACTIVADO -->
      <div *ngIf="user?.twofa_enabled">
        <mat-form-field appearance="outline">
          <mat-label>Introduce token para desactivar</mat-label>
          <input matInput [(ngModel)]="tokenInput" />
        </mat-form-field>

        <button mat-raised-button color="warn" (click)="desactivar2FA()">
          Desactivar 2FA
        </button>
      </div>
    </mat-expansion-panel>

    <!-- NOTIFICACIONES -->
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>Notificaciones</mat-panel-title>
      </mat-expansion-panel-header>

      <div class="checkbox-group">
        <div class="checkbox-item">
          <mat-checkbox [(ngModel)]="notiEmail" name="notiEmail">
            Recibir notificaciones por correo electr√≥nico
          </mat-checkbox>
        </div>
        <div class="checkbox-item">
          <mat-checkbox [(ngModel)]="notiAlertas" name="notiAlertas">
            Alertas cr√≠ticas del sistema
          </mat-checkbox>
        </div>
      </div>
    </mat-expansion-panel>

    <!-- PREFERENCIAS -->
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>Preferencias</mat-panel-title>
      </mat-expansion-panel-header>

      <div class="preferencias-content">
        <div class="preference-field">
          <mat-form-field appearance="outline">
            <mat-label>Tema de la aplicaci√≥n</mat-label>
            <mat-select [(ngModel)]="tema" name="tema">
              <mat-option value="claro">üåû Modo claro</mat-option>
              <mat-option value="oscuro">üåô Modo oscuro</mat-option>
            </mat-select>
            <mat-icon matSuffix>palette</mat-icon>
          </mat-form-field>
        </div>

        <div class="preference-field">
          <mat-form-field appearance="outline">
            <mat-label>Idioma preferido</mat-label>
            <mat-select [(ngModel)]="idioma" name="idioma">
              <mat-option value="es">üá™üá∏ Espa√±ol</mat-option>
              <mat-option value="en">üá∫üá∏ Ingl√©s</mat-option>
            </mat-select>
            <mat-icon matSuffix>language</mat-icon>
          </mat-form-field>
        </div>
      </div>
    </mat-expansion-panel>
  </mat-accordion>
</div>
